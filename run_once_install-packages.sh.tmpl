#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

{{ if eq .chezmoi.os "linux" -}}
{{ if eq .chezmoi.osRelease.id "debian" -}}
sudo apt install \
  zsh \
  zsh-autosuggestions \
  zsh-syntax-highlighting \
  gnupg \
  vim \
  neovim \
  python3-neovim \
  fzf \
  exa \
  ripgrep \
  fd-find \
  jq \
  restic \
  kubectl \
  helm \
  awscli

sudo apt install snapd
sudo snap install starship
sudo snap install bw
sudo snap install batcat
sudo snap install yq

echo 'git-delta must be manually installed'
echo 'rustup must be manually installed'
echo 'dust must be install using cargo'
{{ else if eq .chezmoi.osRelease.id "arch" -}}
if ! command -v paru &> /dev/null
then
  sudo pacman -S --needed base-devel rustup
  rustup toolchain install stable
  BUILDDIR=$(mktemp -d)
  git clone https://aur.archlinux.org/paru.git $BUILDDIR
  pushd $BUILDDIR
  makepkg -si
  popd $BUILDDIR
  rm -rf $BUILDDIR
fi

paru -S --needed \
  aws-cli \
  base-devel \
  bat \
  bitwarden-cli \
  dust \
  exa \
  fd \
  flux-bin \
  fzf \
  git \
  git-delta \
  gnupg \
  helm \
  jq \
  kitty \
  kubectl \
  neovim \
  restic \
  ripgrep \
  rustup \
  starship \
  vim \
  yq \
  zsh \
  zsh-autosuggestions \
  zsh-completions \
  zsh-syntax-highlighting

paru -S --asdeps --needed \
  python-neovim \
  wl-clipboard \
  xsel
{{ end -}}
{{ else if eq .chezmoi.os "darwin" -}}
brew install \
  zsh \
  zsh-autosuggestions \
  zsh-syntax-highlighting \
  gnupg \
  vim \
  neovim \
  fzf \
  exa \
  ripgrep \
  fd \
  dust \
  jq \
  restic \
  kubectl \
  helm \
  awscli \
  starship \
  bitwarden-cli \
  bat \
  yq \
  fluxcd/tap/flux \
  git-delta \
  rustup \
  kitty

pip3 install --user pynvim
{{ end -}}
